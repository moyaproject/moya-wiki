<?xml version="1.0" encoding="UTF-8"?>
<moya xmlns="http://moyaproject.com"
      xmlns:let="http://moyaproject.com/let"
      xmlns:db="http://moyaproject.com/db"
      xmlns:forms="http://moyaproject.com/forms"
      xmlns:html="http://moyaproject.com/html"
      xmlns:w="http://moyaproject.com/widgets"
      xmlns:img="http://moyaproject.com/imagelib"
      xmlns:wiki="http://moyaproject.com/wiki">

    <content libname="content.base" template="page.html">
        <title>${revision.title}</title>
        <include-js path="js/wiki.js"/>
        <include-js path="js/jsonrpc.js" from="moya.jsonrpc" />
        <section name="main">
        </section>
    </content>

    <content libname="content.page" extends="#content.base">
        <section name="main">
            <w:warning if="revision.is_draft and revision.author==.user">
                <md>
This is your *draft*, and is only visible to you.

Use the admin panel to *publish* your changes.
                </md>
            </w:warning>
            <wiki:revision page="page" revision="revision"/>
        </section>
        <section name="side">
           <wiki:admin-panel page="page" revision="revision"/>
        </section>
        <!--
        <section name="admin_links" merge="append" if=".permissions.admin">
            <w:link name="page_edit" let:slug=".url.slug" icon="edit">Edit Page</w:link>
        </section>
        -->
    </content>

    <content libname="content.front" extends="#content.base">
        <title>Wiki</title>
        <forms:get form="#form.page.new" dst="form"/>
        <section name="main">
            <md>
# Welcome to your wiki!
            </md>
        </section>
        <section name="side">
            <render src="form"/>
        </section>
    </content>

    <content libname="content.page.missing" extends="#content.base">
        <title>Page Not Found</title>
        <section name="main">
            <get-url name="page_create" let:slug="slug" dst="create_url"/>
            <w:info>
                <md>No page here. Would you like to [Create it](${create_url})?</md>
            </w:info>
        </section>
    </content>

    <content libname="content.page.create" extends="#content.base">
        <title>Create ${page_url}</title>
        <section name="main">
          <render src="form"/>
        </section>
    </content>

    <content libname="content.page.publish" extends="#content.base">
        <title>Publish ${page_url}</title>
        <section name="main">
          <render src="form"/>
        </section>
    </content>

    <content libname="content.page.discard" extends="#content.base">
        <title>Publish ${page_url}</title>
        <section name="main">
          <render src="form"/>
        </section>
    </content>

    <content libname="content.page.default" extends="#content.base">
        <title>Make ${revision.version} default</title>
        <section name="main">
          <render src="form"/>
        </section>
    </content>

    <content libname="content.page.edit" extends="#content.base">
        <title>Edit ${revision.title}</title>
        <include-css path="css/draft.css"/>
        <section name="main" merge="prepend">
            <render src="form"/>
            <node template="editor/draft.html"/>
        </section>
    </content>

</moya>
